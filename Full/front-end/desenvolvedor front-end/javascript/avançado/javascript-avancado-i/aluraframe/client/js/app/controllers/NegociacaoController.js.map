{"version":3,"sources":["../../app-es6/controllers/NegociacaoController.js"],"names":["ListaNegociacoes","Mensagem","Negociacao","MensagemView","NegociacoesView","NegociacaoService","Bind","DateConverter","NegociacaoController","$","document","querySelector","bind","_inputData","_inputQuantidade","_inputValor","_listaNegociacoes","_negociacaoService","_mensagem","_ordemAtual","_init","lista","then","negociacoes","forEach","adiciona","negociacao","catch","texto","erro","setInterval","importaNegociacoes","event","preventDefault","_criaNegociacao","cadastrar","mensagem","_limpaFormulario","importa","coluna","inverteOrdem","ordena","a","b","apaga","esvazia","textoParaData","value","parseInt","parseFloat","focus","negociacaoController","currentInstance"],"mappings":";;;;;;;;;;;;;;;AAASA,4B,2BAAAA,gB;;AACAC,oB,mBAAAA,Q;;AACAC,sB,qBAAAA,U;;AACAC,wB,sBAAAA,Y;;AACAC,2B,yBAAAA,e;;AACAC,6B,8BAAAA,iB;;AACAC,gB,gBAAAA,I;;AACAC,yB,yBAAAA,a;;;;;;;;;;;;;;;;;;;;;AAGHC,gC;AAEF,gDAAc;AAAA;;AACV;AACA,wBAAIC,IAAIC,SAASC,aAAT,CAAuBC,IAAvB,CAA4BF,QAA5B,CAAR;;AAGA,yBAAKG,UAAL,GAAkBJ,EAAE,OAAF,CAAlB;AACA,yBAAKK,gBAAL,GAAwBL,EAAE,aAAF,CAAxB;AACA,yBAAKM,WAAL,GAAmBN,EAAE,QAAF,CAAnB;;AAEA;AACA,yBAAKO,iBAAL,GAAyB,IAAIV,IAAJ,CACrB,IAAIN,gBAAJ,EADqB,EAErB,IAAII,eAAJ,CAAoBK,EAAE,kBAAF,CAApB,CAFqB,EAGrB,UAHqB,EAGT,SAHS,EAGE,QAHF,EAGY,cAHZ,CAAzB;;AAMA,yBAAKQ,kBAAL,GAA0B,IAAIZ,iBAAJ,EAA1B;;AAEA,yBAAKa,SAAL,GAAiB,IAAIZ,IAAJ,CAAS,IAAIL,QAAJ,EAAT,EAAyB,IAAIE,YAAJ,CAAiBM,EAAE,eAAF,CAAjB,CAAzB,EAA+D,OAA/D,CAAjB;;AAEA,yBAAKU,WAAL,GAAmB,EAAnB;;AAEA,yBAAKC,KAAL;AAEH;;;;4CAEO;AAAA;;AAEJ,6BAAKH,kBAAL,CACKI,KADL,GAEKC,IAFL,CAEU;AAAA,mCACFC,YAAYC,OAAZ,CAAoB;AAAA,uCAChB,MAAKR,iBAAL,CAAuBS,QAAvB,CAAgCC,UAAhC,CADgB;AAAA,6BAApB,CADE;AAAA,yBAFV,EAKKC,KALL,CAKW;AAAA,mCAAQ,MAAKT,SAAL,CAAeU,KAAf,GAAuBC,IAA/B;AAAA,yBALX;;AAOAC,oCAAY;AAAA,mCAAM,MAAKC,kBAAL,EAAN;AAAA,yBAAZ,EAA6C,IAA7C;AACH;;;6CAEQC,K,EAAO;AAAA;;AAEZA,8BAAMC,cAAN;;AAEA,4BAAIP,aAAa,KAAKQ,eAAL,EAAjB;;AAEA,6BAAKjB,kBAAL,CACKkB,SADL,CACeT,UADf,EAEKJ,IAFL,CAEU,oBAAY;;AAEd,mCAAKN,iBAAL,CAAuBS,QAAvB,CAAgCC,UAAhC;AACA,mCAAKR,SAAL,CAAeU,KAAf,GAAuBQ,QAAvB;AACA;AACA,mCAAKC,gBAAL;AACH,yBARL,EASKV,KATL,CASW;AAAA,mCAAQ,OAAKT,SAAL,CAAeU,KAAf,GAAuBC,IAA/B;AAAA,yBATX;AAUH;;;yDAEoB;AAAA;;AAEjB;;AAEA;;;;;;;;;;AAUA,6BAAKZ,kBAAL,CACKqB,OADL,CACa,KAAKtB,iBAAL,CAAuBO,WADpC,EAEKD,IAFL,CAEU,uBAAe;AACjBC,wCAAYC,OAAZ,CAAoB;AAAA,uCAAc,OAAKR,iBAAL,CAAuBS,QAAvB,CAAgCC,UAAhC,CAAd;AAAA,6BAApB;AACA,mCAAKR,SAAL,CAAeU,KAAf,GAAuB,gDAAvB;AACH,yBALL,EAKOD,KALP,CAKa;AAAA,mCAAQ,OAAKT,SAAL,CAAeU,KAAf,GAAuBC,IAA/B;AAAA,yBALb;;AAOA;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AA6CH;;;2CAEMU,M,EAAQ;;AAEX,4BAAI,KAAKpB,WAAL,IAAoBoB,MAAxB,EAAgC;;AAE5B,iCAAKvB,iBAAL,CAAuBwB,YAAvB;AACA,iCAAKrB,WAAL,GAAmB,EAAnB;AACH,yBAJD,MAIO;;AAEH,iCAAKH,iBAAL,CAAuByB,MAAvB,CAA8B,UAACC,CAAD,EAAIC,CAAJ;AAAA,uCAAUD,EAAEH,MAAF,IAAYI,EAAEJ,MAAF,CAAtB;AAAA,6BAA9B;AACA,iCAAKpB,WAAL,GAAmBoB,MAAnB;AACH;AAEJ;;;4CAEO;AAAA;;AAEJ,6BAAKtB,kBAAL,CACK2B,KADL,GAEKtB,IAFL,CAEU,oBAAY;;AAEd,mCAAKJ,SAAL,CAAeU,KAAf,GAAuBQ,QAAvB;AACA,mCAAKpB,iBAAL,CAAuB6B,OAAvB;AACH,yBANL,EAOKlB,KAPL,CAOW;AAAA,mCAAQ,OAAKT,SAAL,CAAeU,KAAf,GAAuBC,IAA/B;AAAA,yBAPX;AASH;;;sDAEiB;;AAEd,+BAAO,IAAI3B,UAAJ,CACHK,cAAcuC,aAAd,CAA4B,KAAKjC,UAAL,CAAgBkC,KAA5C,CADG,EAEHC,SAAS,KAAKlC,gBAAL,CAAsBiC,KAA/B,CAFG,EAGHE,WAAW,KAAKlC,WAAL,CAAiBgC,KAA5B,CAHG,CAAP;AAKH;;;uDAEkB;;AAEf,6BAAKlC,UAAL,CAAgBkC,KAAhB,GAAwB,EAAxB;AACA,6BAAKjC,gBAAL,CAAsBiC,KAAtB,GAA8B,CAA9B;AACA,6BAAKhC,WAAL,CAAiBgC,KAAjB,GAAyB,GAAzB;AACA,6BAAKlC,UAAL,CAAgBqC,KAAhB;AACH;;;;;;AAGDC,gC,GAAuB,IAAI3C,oBAAJ,E;AACpB,qBAAS4C,eAAT,GAA2B;;AAE9B,uBAAOD,oBAAP;AACH","file":"NegociacaoController.js","sourcesContent":["import { ListaNegociacoes } from '../models/ListaNegociacoes';\r\nimport { Mensagem } from '../models/Mensagem';\r\nimport { Negociacao } from '../models/Negociacao';\r\nimport { MensagemView } from '../views/MensagemView';\r\nimport { NegociacoesView } from '../views/NegociacoesView';\r\nimport { NegociacaoService } from '../services/NegociacaoService';\r\nimport { Bind } from '../helpers/Bind';\r\nimport { DateConverter } from '../helpers/DateConverter';\r\n\r\n\r\nclass NegociacaoController {\r\n\r\n    constructor() {\r\n        //Cria um CACHE no construtor evitando que busque toda vez os elementos do DOM ao chamar o método adiciona()\r\n        let $ = document.querySelector.bind(document);\r\n\r\n\r\n        this._inputData = $('#data');\r\n        this._inputQuantidade = $('#quantidade');\r\n        this._inputValor = $('#valor');\r\n\r\n        //Classe Bind retorna a Instância de um Proxy\r\n        this._listaNegociacoes = new Bind(\r\n            new ListaNegociacoes(),\r\n            new NegociacoesView($('#negociacoesView')),\r\n            'adiciona', 'esvazia', 'ordena', 'inverteOrdem'\r\n        );\r\n\r\n        this._negociacaoService = new NegociacaoService();\r\n\r\n        this._mensagem = new Bind(new Mensagem(), new MensagemView($('#mensagemView')), 'texto');\r\n\r\n        this._ordemAtual = '';\r\n\r\n        this._init();\r\n\r\n    }\r\n\r\n    _init() {\r\n\r\n        this._negociacaoService\r\n            .lista()\r\n            .then(negociacoes =>\r\n                negociacoes.forEach(negociacao =>\r\n                    this._listaNegociacoes.adiciona(negociacao)))\r\n            .catch(erro => this._mensagem.texto = erro);\r\n\r\n        setInterval(() => this.importaNegociacoes(), 3000);\r\n    }\r\n\r\n    adiciona(event) {\r\n\r\n        event.preventDefault();\r\n\r\n        let negociacao = this._criaNegociacao();\r\n\r\n        this._negociacaoService\r\n            .cadastrar(negociacao)\r\n            .then(mensagem => {\r\n\r\n                this._listaNegociacoes.adiciona(negociacao);\r\n                this._mensagem.texto = mensagem;\r\n                //Setter da mensagem para ser exibida\r\n                this._limpaFormulario();\r\n            })\r\n            .catch(erro => this._mensagem.texto = erro);\r\n    }\r\n\r\n    importaNegociacoes() {\r\n\r\n        /* ------------------ PROMISE PATTERN RESOLUTION --------------------- */\r\n\r\n        /* OBS.(Utilizamos o método estático all() da classe PROMISE na qual recebe como parâmetro um\r\n                array de objetos Promise. Desta maneira as Promises (que neste caso são execuções\r\n                de requisições assíncronas do AJAX) são executadas na ordem (ou em sincronia) dentro \r\n                deste array. Cada execução dos objetos Promise retornam uma função RESOLVE(executada no THEN) \r\n                e um REJECT(executada no CATCH). No THEN, se for executado todos os RESOLVE, irá formar\r\n                um Array de Array's onde cada array dentro da array possue objetos Negociação.\r\n                Usamos o REDUCE para formar um Array com todos os objetos Negociação, ou seja, os\r\n                objetos Negociacao de cada Array foram tranferidos para esta nova Array(flatArray).\r\n                Com o FOREACH adicionamos todos os objetos da flatArray). */\r\n\r\n        this._negociacaoService\r\n            .importa(this._listaNegociacoes.negociacoes)\r\n            .then(negociacoes => {\r\n                negociacoes.forEach(negociacao => this._listaNegociacoes.adiciona(negociacao));\r\n                this._mensagem.texto = 'Negociacoes do período importadas com sucesso.';\r\n            }).catch(erro => this._mensagem.texto = erro);\r\n\r\n        /* \r\n            ------------CALLBACK RESOLUTION--------------------------\r\n\r\n            OBS.(Este modelo de implementação para esta situação \r\n                se tornou muito verboso,pois repetimos muitas vezes \r\n                a utilização de ERROR-FIRST ocasionando uma cadeia de if's\r\n                e callback's consecutivos (CALLBACK HELL) para sincronizar\r\n                as requisiçoes assíncronas do AJAX formando assim, esta pirâmide \r\n                de código (Pyramid of Doom))\r\n    \r\n            let service = new NegociacaoService();\r\n        \r\n            service.obterNegociacoesDaSemana((erro, negociacoes) => {\r\n\r\n            if (erro) {\r\n\r\n                this._mensagem.texto = erro;\r\n                return\r\n            }\r\n\r\n            negociacoes.forEach(negociacao => { this._listaNegociacoes.adiciona(negociacao) });\r\n\r\n            service.obterNegociacoesDaSemanaAnterior((erro, negociacoes) => {\r\n\r\n                if (erro) {\r\n\r\n                    this._mensagem.texto = erro;\r\n                    return\r\n                }\r\n\r\n                negociacoes.forEach(negociacao => { this._listaNegociacoes.adiciona(negociacao) });\r\n\r\n                service.obterNegociacoesDaSemanaRetrasada((erro, negociacoes) => {\r\n\r\n                    if (erro) {\r\n\r\n                        this._mensagem.texto = erro;\r\n                        return\r\n                    }\r\n\r\n                    negociacoes.forEach(negociacao => { this._listaNegociacoes.adiciona(negociacao) });\r\n                    this._mensagem.texto = 'Negociações importadas com sucesso.';\r\n                });\r\n            });\r\n        }); */\r\n    }\r\n\r\n    ordena(coluna) {\r\n\r\n        if (this._ordemAtual == coluna) {\r\n\r\n            this._listaNegociacoes.inverteOrdem();\r\n            this._ordemAtual = '';\r\n        } else {\r\n\r\n            this._listaNegociacoes.ordena((a, b) => a[coluna] - b[coluna]);\r\n            this._ordemAtual = coluna;\r\n        }\r\n\r\n    }\r\n\r\n    apaga() {\r\n\r\n        this._negociacaoService\r\n            .apaga()\r\n            .then(mensagem => {\r\n\r\n                this._mensagem.texto = mensagem;\r\n                this._listaNegociacoes.esvazia();\r\n            })\r\n            .catch(erro => this._mensagem.texto = erro);\r\n\r\n    }\r\n\r\n    _criaNegociacao() {\r\n\r\n        return new Negociacao(\r\n            DateConverter.textoParaData(this._inputData.value),\r\n            parseInt(this._inputQuantidade.value),\r\n            parseFloat(this._inputValor.value)\r\n        );\r\n    }\r\n\r\n    _limpaFormulario() {\r\n\r\n        this._inputData.value = '';\r\n        this._inputQuantidade.value = 1;\r\n        this._inputValor.value = 0.0;\r\n        this._inputData.focus();\r\n    }\r\n}\r\n\r\nlet negociacaoController = new NegociacaoController();\r\nexport function currentInstance() {\r\n\r\n    return negociacaoController;\r\n}"]}